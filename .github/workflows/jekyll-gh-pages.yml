name: GitHub Actions Build and Deploy Demo

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@master
    - name: Set up Node
      uses: actions/setup-node@v3
      with:
        node-version: 18.19.0
        cache: 'npm'
    - name: Cache
      # ç¼“å­˜å‘½ä¸­ç»“æœä¼šå­˜å‚¨åœ¨steps.[id].outputs.cache-hité‡Œï¼Œè¯¥å˜é‡åœ¨ç»§åçš„stepä¸­å¯è¯»
      id: cache-dependencies
      uses: actions/cache@v3
      with:
        # ç¼“å­˜æ–‡ä»¶ç›®å½•çš„è·¯å¾„
        path: |
          **/node_modules
        # keyä¸­å®šä¹‰ç¼“å­˜æ ‡å¿—ä½çš„ç”Ÿæˆæ–¹å¼ã€‚runner.OSæŒ‡å½“å‰ç¯å¢ƒçš„ç³»ç»Ÿã€‚å¤–åŠ å¯¹yarn.lockå†…å®¹ç”Ÿæˆå“ˆå¸Œç ä½œä¸ºkeyå€¼ï¼Œå¦‚æœyarn.lockæ”¹å˜åˆ™ä»£è¡¨ä¾èµ–æœ‰å˜åŒ–ã€‚
        # è¿™é‡Œç”¨yarn.lockè€Œä¸æ˜¯package.jsonæ˜¯å› ä¸ºpackage.jsonä¸­è¿˜æœ‰versionå’Œdescriptionä¹‹ç±»çš„æè¿°é¡¹ç›®ä½†å’Œä¾èµ–æ— å…³çš„å±æ€§
        key: ${{runner.OS}}-${{hashFiles('**/pnpm-lock.yaml')}}
    - name: Set registry
      run: npm config set registry https://registry.npmmirror.com
    - name: Install pnpm
      run: npm i -g pnpm
    - name: Set pnpm registry
      run: pnpm config set registry https://registry.npmmirror.com
    - name: Install dependencies
      run: pnpm i
    - name: Build
      run: pnpm build
    - name: Configure SSH
      env:
        ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
    - name: Deploy ğŸš€ # éƒ¨ç½²
      uses: JamesIves/github-pages-deploy-action@v4.3.3
      with:
        branch: static-pages # éƒ¨ç½²åæäº¤åˆ°çš„åˆ†æ”¯
        folder: dist # è¿™é‡Œå¡«æ‰“åŒ…å¥½çš„ç›®å½•åç§°